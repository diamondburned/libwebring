name: Update webring status

inputs:
  webring-input:
    default: webring.json
  status-output:
    default: "" # webring.json -> webring.status.json
  commit:
    default: false
  commit-message:
    default: "Update webring status file"

runs:
  using: composite
  steps:
    - name: Go to action repository
      run: pushd ${{ github.action_path }}/../../../ && ls -la && echo "why does this not work :sobbing:"
      shell: bash

    - name: Install Nix dependencies
      uses: diamondburned/cache-install@main
      with:
        shell-file: shell.nix
        auto-optimise: true

    - name: Run health check
      run: |
        ./cmd/health-check.ts \
          -i ${{ inputs.webring-input }} \
          -o ${{ inputs.status-output }}
      shell: bash

    - name: Commit changes
      if: ${{ inputs.commit }}
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: ${{ inputs.commit-message }}

    - name: Restore current directory
      run: popd
      shell: bash
